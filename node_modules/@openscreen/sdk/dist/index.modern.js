import{promises as t}from"fs";import e from"moment";import{CognitoUser as r,CognitoUserPool as n,AuthenticationDetails as s,CognitoUserAttribute as i}from"amazon-cognito-identity-js";import o from"axios";function c(){return c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},c.apply(this,arguments)}function u(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,h(t,e)}function h(t,e){return h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},h(t,e)}var a,d,g,P,p,f,l,m,v,S,y=function(t){function e(){return t.apply(this,arguments)||this}u(e,t);var r=e.prototype;return r.authenticateUser=function(e){try{var r=this;return Promise.resolve(new Promise(function(n,s){t.prototype.authenticateUser.call(r,e,{onSuccess:function(t){return n({session:t})},onFailure:function(t){return s(t)},mfaRequired:function(t,e){return n({challengeName:t,challengeParameters:e})},selectMFAType:function(t,e){return n({challengeName:t,challengeParameters:e})},mfaSetup:function(t,e){return n({challengeName:t,challengeParameters:e})},totpRequired:function(t,e){return n({challengeName:t,challengeParameters:e})},customChallenge:function(t){return n({challengeParameters:t})}})}))}catch(t){return Promise.reject(t)}},r.getSession=function(){try{var e=this;return Promise.resolve(new Promise(function(r,n){t.prototype.getSession.call(e,function(t,e){return t?n(t):r(e)})}))}catch(t){return Promise.reject(t)}},e}(r),k=function(t){function e(){return t.apply(this,arguments)||this}u(e,t);var r=e.prototype;return r.getStorage=function(){return this.storage},r.getClientId=function(){return this.clientId},r.signUp=function(e,r,n,s){try{var i=this;return Promise.resolve(new Promise(function(o,c){t.prototype.signUp.call(i,e,r,n,s,function(t,e){return t?c(t):o(e)})}))}catch(t){return Promise.reject(t)}},e}(n),E=function(){function t(t,e,r){this.userPool=void 0,this.userPool=new k({UserPoolId:t,ClientId:e,Storage:r})}var e=t.prototype;return e.getCognitoUserPool=function(){return this.userPool},e.getStorage=function(){return this.userPool.getStorage()},e.getUser=function(t){if(t){var e=this.userPool.getStorage().getItem("keyToUsername."+Buffer.from(t).toString("base64"));return e?new y({Username:e,Pool:this.userPool,Storage:this.userPool.getStorage()}):null}var r=this.userPool.getStorage().getItem("CognitoIdentityServiceProvider."+this.userPool.getClientId()+".LastAuthUser");return r?new y({Username:r,Pool:this.userPool,Storage:this.userPool.getStorage()}):null},e.authenticate=function(t,e){try{var r=this,n=new y({Username:t,Pool:r.userPool,Storage:r.userPool.getStorage()}),i=new s({Username:t,Password:e});return Promise.resolve(n.authenticateUser(i).then(function(e){if(e.session){var s=n.getUsername();return r.userPool.getStorage().setItem("keyToUsername."+Buffer.from(t).toString("base64"),s),n}return null}))}catch(t){return Promise.reject(t)}},e.signUp=function(t,e,r){try{var n=[];return n.push(new i({Name:"given_name",Value:r.givenName})),n.push(new i({Name:"middle_name",Value:r.middleName})),n.push(new i({Name:"family_name",Value:r.familyName})),n.push(new i({Name:"phone_number",Value:r.phoneNumber})),n.push(new i({Name:"email",Value:t})),Promise.resolve(this.userPool.signUp(t,e,n,[]))}catch(t){return Promise.reject(t)}},t}(),I=function(){function t(t){this.session=void 0,this.axios=void 0,this.session=t,this.axios=o.create({timeout:1e4,responseType:"json",maxContentLength:5e4,maxBodyLength:5e4,maxRedirects:1,decompress:!0})}var e=t.prototype;return e.makeURL=function(t){try{return Promise.resolve(this.session.getCloudConfig()).then(function(e){return function(t){var e=[t.replace(/\/+$/,"")];return[].slice.call(arguments,1).forEach(function(t){t&&""!==t&&e.push(t.replace(/^\/+/,""))}),e.join("/")}(e.endpoint,t)})}catch(t){return Promise.reject(t)}},e.getAuthorization=function(){try{return Promise.resolve(this.session.getActiveUser()).then(function(t){return Promise.resolve(t.getSession()).then(function(t){if(!t)throw Error("Openscreen No session available");return Promise.resolve(t.getAccessToken().getJwtToken()).then(function(t){return"Bearer "+t})})})}catch(t){return Promise.reject(t)}},e.post=function(t,e,r,n){void 0===e&&(e={}),void 0===r&&(r={}),void 0===n&&(n={});try{var s=this;return Promise.resolve(s.makeURL(t)).then(function(t){process.env.OS_DEBUG&&(console.debug("POST "+t),console.debug(JSON.stringify(r,null,2)));var i=s.axios,o=i.post;return Promise.resolve(s.getAuthorization()).then(function(s){return Promise.resolve(o.call(i,t,r,c({headers:{Authorization:s},params:e},n))).then(function(t){return process.env.OS_DEBUG&&console.debug("RESPONSE",JSON.stringify(t.data,null,2)),t.data})})})}catch(t){return Promise.reject(t)}},e.postBatch=function(t,e,r,n){void 0===e&&(e={}),void 0===n&&(n={});try{var s=this;return Promise.resolve(s.makeURL(t)).then(function(t){process.env.OS_DEBUG&&(console.debug("POST "+t),console.debug(JSON.stringify(r,null,2)));var i=s.axios,o=i.post;return Promise.resolve(s.getAuthorization()).then(function(s){return Promise.resolve(o.call(i,t,r,c({headers:{Authorization:s},params:e},n))).then(function(t){return process.env.OS_DEBUG&&console.debug("RESPONSE",JSON.stringify(t.data,null,2)),t.data})})})}catch(t){return Promise.reject(t)}},e.get=function(t,e,r){void 0===e&&(e={}),void 0===r&&(r={});try{var n=this;return Promise.resolve(n.makeURL(t)).then(function(t){process.env.OS_DEBUG&&console.debug("GET "+t);var s=n.axios,i=s.get;return Promise.resolve(n.getAuthorization()).then(function(n){return Promise.resolve(i.call(s,t,c({headers:{Authorization:n},params:e},r))).then(function(t){return process.env.OS_DEBUG&&console.debug("RESPONSE",JSON.stringify(t.data,null,2)),t.data})})})}catch(t){return Promise.reject(t)}},e.getList=function(t,e,r){void 0===e&&(e={}),void 0===r&&(r={});try{var n=this;return Promise.resolve(n.makeURL(t)).then(function(t){process.env.OS_DEBUG&&console.debug("GET "+t);var s=n.axios,i=s.get;return Promise.resolve(n.getAuthorization()).then(function(n){return Promise.resolve(i.call(s,t,c({headers:{Authorization:n},params:e},r))).then(function(t){return process.env.OS_DEBUG&&console.debug("RESPONSE",JSON.stringify(t.data,null,2)),t.data})})})}catch(t){return Promise.reject(t)}},e.patch=function(t,e,r,n){void 0===e&&(e={}),void 0===r&&(r={}),void 0===n&&(n={});try{var s=this;return Promise.resolve(s.makeURL(t)).then(function(t){process.env.OS_DEBUG&&(console.debug("PATCH "+t),console.debug(JSON.stringify(r,null,2)));var i=o.patch;return Promise.resolve(s.getAuthorization()).then(function(s){return Promise.resolve(i.call(o,t,r,c({headers:{Authorization:s},params:e,data:r},n))).then(function(t){return process.env.OS_DEBUG&&console.debug("RESPONSE",JSON.stringify(t.data,null,2)),t.data})})})}catch(t){return Promise.reject(t)}},e.delete=function(t,e,r){void 0===e&&(e={}),void 0===r&&(r={});try{var n=this;return Promise.resolve(n.makeURL(t)).then(function(s){process.env.OS_DEBUG&&console.debug("DELETE "+s);var i=o.delete;return Promise.resolve(n.makeURL(t)).then(function(t){return Promise.resolve(n.getAuthorization()).then(function(n){return Promise.resolve(i.call(o,t,c({headers:{Authorization:n},params:e},r))).then(function(){return!0})})})})}catch(t){return Promise.reject(t)}},t}(),b=function(){function t(t,e,r,n,s){if(this.session=void 0,this.request=void 0,this.id=void 0,this.path=void 0,this.sdkPath=void 0,this.session=t,this.request=t.getRequest(n),this.id=s,this.path=s?e+"/"+n+"/"+s:e+"/"+n,s){var i=(o=n).endsWith("s")?o.substring(0,o.length-1):o;this.sdkPath=r+"."+i+"("+i+"Id)"}else this.sdkPath=r+"."+n+"()";var o}var e=t.prototype;return e.getSession=function(){return this.session},e.getPath=function(){return this.path},e.getSdkPath=function(){return this.sdkPath},e.describeSdkEndpoints=function(t){t.push(this.getSdkPath())},t}(),j=function(t){function e(e){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"projects")||this}u(e,t);var r=e.prototype;return r.create=function(t){try{return Promise.resolve(this.request.post(this.getPath(),{},t))}catch(t){return Promise.reject(t)}},r.get=function(){try{return Promise.resolve(this.request.getList(this.getPath()))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".create(project: IProject)"),t.push(this.getSdkPath()+".get(): IProject")},e}(b),q=function(t){function e(e,r){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"projects",r)||this}u(e,t);var r=e.prototype;return r.moveProjectToAccount=function(){try{return Promise.resolve(this.request.post(this.getPath(),{},{})).then(function(){return!0})}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".moveProjectToAccount()")},e}(b),C=function(t){function e(e){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"apikeys")||this}u(e,t);var r=e.prototype;return r.create=function(t){try{return Promise.resolve(this.request.post(this.getPath(),{},t))}catch(t){return Promise.reject(t)}},r.get=function(){try{return Promise.resolve(this.request.getList(this.getPath()))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".create(apiKey: IApiKey)"),t.push(this.getSdkPath()+".get(): IApiKey")},e}(b),w=function(t){function e(e){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"invitations")||this}u(e,t);var r=e.prototype;return r.create=function(t){try{return Promise.resolve(this.request.post(this.getPath(),{},t))}catch(t){return Promise.reject(t)}},r.get=function(){try{return Promise.resolve(this.request.getList(this.getPath()))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".create(invitation: IAccountInvitation)"),t.push(this.getSdkPath()+".get(): IAccountInvitation")},e}(b),A=function(t){function e(e){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"users")||this}u(e,t);var r=e.prototype;return r.get=function(){try{return Promise.resolve(this.request.getList(this.getPath()))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".get(): IUser")},e}(b),N=function(t){function e(e,r){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"users",r)||this}u(e,t);var r=e.prototype;return r.delete=function(){try{return Promise.resolve(this.request.delete(this.getPath()))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".delete()")},e}(b),U=function(t){function e(e,r,n,s){return t.call(this,e,r,n,"accounts",s)||this}u(e,t);var r=e.prototype;return r.get=function(){try{return Promise.resolve(this.request.get(this.getPath()))}catch(t){return Promise.reject(t)}},r.update=function(t){try{return Promise.resolve(this.request.patch(this.getPath(),{},t))}catch(t){return Promise.reject(t)}},r.delete=function(){try{return Promise.resolve(this.request.delete(this.getPath()))}catch(t){return Promise.reject(t)}},r.apiKeys=function(){return new C(this)},r.invitations=function(){return new w(this)},r.projects=function(){return new j(this)},r.project=function(t){return new q(this,t)},r.users=function(){return new A(this)},r.user=function(t){return new N(this,t)},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".get(): IAccount"),t.push(this.getSdkPath()+".update(properties: IAccount): Object"),t.push(this.getSdkPath()+".delete()"),this.apiKeys().describeSdkEndpoints(t),this.invitations().describeSdkEndpoints(t),this.projects().describeSdkEndpoints(t),this.project("{projectId}").describeSdkEndpoints(t),this.users().describeSdkEndpoints(t),this.user("{userId}").describeSdkEndpoints(t)},e}(b),O=function(t){function e(e,r,n,s){return t.call(this,e,r,n,"apikeys",s)||this}u(e,t);var r=e.prototype;return r.get=function(){try{return Promise.resolve(this.request.get(this.getPath()))}catch(t){return Promise.reject(t)}},r.update=function(t){try{return Promise.resolve(this.request.patch(this.getPath(),{},t))}catch(t){return Promise.reject(t)}},r.resetSecret=function(){try{return Promise.resolve(this.request.patch(this.getPath()+"/secret",{},{}))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".get()"),t.push(this.getSdkPath()+".update(properties: IApiKey)"),t.push(this.getSdkPath()+".resetSecret()")},e}(b);!function(t){t.ACTIVE="ACTIVE",t.SUSPENDED="SUSPENDED"}(a||(a={})),function(t){t.OWNER="OWNER",t.ADMINISTRATOR="ADMINISTRATOR",t.BILLING_CONTACT="BILLING_CONTACT",t.MEMBER="MEMBER",t.API_KEY="API-KEY",t.INVITATION_DECLINED="INVITATION_DECLINED"}(d||(d={})),function(t){t.ACCEPTED="ACCEPTED",t.PENDING="PENDING",t.EXPIRED="EXPIRED"}(g||(g={})),function(t){t.ACTIVE="ACTIVE",t.SUSPENDED="SUSPENDED"}(P||(P={})),function(t){t.OWNER="OWNER",t.ADMINISTRATOR="ADMINISTRATOR",t.BILLING_CONTACT="BILLING_CONTACT",t.MEMBER="MEMBER",t.API_KEY="API_KEY"}(p||(p={})),function(t){t.L="L",t.M="M",t.Q="Q",t.H="H"}(f||(f={})),function(t){t.STATIC_REDIRECT="STATIC_REDIRECT",t.DYNAMIC_REDIRECT="DYNAMIC_REDIRECT",t.DYNAMIC_REDIRECT_TO_APP="DYNAMIC_REDIRECT_TO_APP"}(l||(l={})),function(t){t.SHORT_URL="SHORT_URL",t.HASHED_ID="HASHED_ID",t.SECURE_ID="SECURE_ID"}(m||(m={})),function(t){t.ACTIVE="ACTIVE",t.SUSPENDED="SUSPENDED"}(v||(v={})),function(t){t.PNG="png",t.SVG="svg"}(S||(S={}));var T=function(t){function e(e){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"contacts")||this}u(e,t);var r=e.prototype;return r.create=function(t){try{return Promise.resolve(this.request.post(this.getPath(),{},t))}catch(t){return Promise.reject(t)}},r.get=function(t){try{return Promise.resolve(this.request.getList(this.getPath(),t))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".create(contact: IContact): Promise<any>"),t.push(this.getSdkPath()+".get(queryParemeters: IGetContactsQueryStringParameters): Promise<IGetContactsResponseBody>")},e}(b),R=function(t){function e(e,r){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"contacts",r)||this}u(e,t);var r=e.prototype;return r.link=function(t){try{return Promise.resolve(this.request.post(this.getPath(),{},{type:t}))}catch(t){return Promise.reject(t)}},r.unlink=function(){try{return Promise.resolve(this.request.delete(this.getPath(),{},{}))}catch(t){return Promise.reject(t)}},r.get=function(){try{return Promise.resolve(this.request.get(this.getPath()))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".link(type: string)"),t.push(this.getSdkPath()+".unlink()"),t.push(this.getSdkPath()+".get(): any")},e}(b),D=function(t){function e(e){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"scans")||this}u(e,t);var r=e.prototype;return r.get=function(t){try{return Promise.resolve(this.request.getList(this.getPath(),t))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".get()")},e}(b),_=function(t){function e(e){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"qrcodes")||this}u(e,t);var r=e.prototype;return r.create=function(t){try{return t.locatorKeyType||(t.locatorKeyType=m.SHORT_URL),Promise.resolve(this.request.post(this.getPath(),{},t))}catch(t){return Promise.reject(t)}},r.get=function(t){try{return Promise.resolve(this.request.get(this.getPath(),t))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".create()"),t.push(this.getSdkPath()+".get()")},e}(b),L=function(t){function e(e,r,n,s){return t.call(this,e,r,n,"assets",s)||this}u(e,t);var r=e.prototype;return r.get=function(){try{return Promise.resolve(this.request.get(this.getPath()))}catch(t){return Promise.reject(t)}},r.update=function(t){try{return Promise.resolve(this.request.patch(this.getPath(),{},t))}catch(t){return Promise.reject(t)}},r.delete=function(){try{return Promise.resolve(this.request.delete(this.getPath()))}catch(t){return Promise.reject(t)}},r.contacts=function(){return new T(this)},r.contact=function(t){return new R(this,t)},r.scans=function(){return new D(this)},r.qrCodes=function(){return new _(this)},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".get()"),t.push(this.getSdkPath()+".update(properties: IAsset)"),t.push(this.getSdkPath()+".delete()"),this.contacts().describeSdkEndpoints(t),this.contact("{contactId}").describeSdkEndpoints(t),this.scans().describeSdkEndpoints(t),this.qrCodes().describeSdkEndpoints(t)},e}(b),B=function(t){function e(e,r,n,s){return t.call(this,e,r,n,"contacts",s)||this}u(e,t);var r=e.prototype;return r.get=function(){try{return Promise.resolve(this.request.get(this.getPath()))}catch(t){return Promise.reject(t)}},r.update=function(t){try{return Promise.resolve(this.request.patch(this.getPath(),{},t))}catch(t){return Promise.reject(t)}},r.delete=function(){try{return Promise.resolve(this.request.delete(this.getPath()))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".get()"),t.push(this.getSdkPath()+".update(properties: IContact)"),t.push(this.getSdkPath()+".delete()")},e}(b),G=function(t){function e(e,r,n,s){return t.call(this,e,r,n,"invitations",s)||this}u(e,t);var r=e.prototype;return r.get=function(){try{return Promise.resolve(this.request.get(this.getPath()))}catch(t){return Promise.reject(t)}},r.delete=function(){try{return Promise.resolve(this.request.delete(this.getPath()))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".get()"),t.push(this.getSdkPath()+".delete()")},e}(b),z=function(t){function e(e){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"assets")||this}u(e,t);var r=e.prototype;return r.create=function(t){try{return Promise.resolve(this.request.post(this.getPath(),{},t))}catch(t){return Promise.reject(t)}},r.get=function(){try{return Promise.resolve(this.request.getList(this.getPath()))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".create()"),t.push(this.getSdkPath()+".get()")},e}(b),M=function(t){function e(e){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"assets")||this}u(e,t);var r=e.prototype;return r.create=function(t){try{return Promise.resolve(this.request.postBatch(this.getPath()+"/batch",{},{assets:t}))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".create() /* batch */")},e}(b),x=function(t){function e(e){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"contacts")||this}u(e,t);var r=e.prototype;return r.create=function(t){try{return Promise.resolve(this.request.post(this.getPath(),{},t))}catch(t){return Promise.reject(t)}},r.get=function(){try{return Promise.resolve(this.request.getList(this.getPath()))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".create()"),t.push(this.getSdkPath()+".get()")},e}(b),F=function(t){function e(e){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"contacts")||this}u(e,t);var r=e.prototype;return r.create=function(t){try{return Promise.resolve(this.request.postBatch(this.getPath()+"/batch",{},{contacts:t}))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".create() /* batch */")},e}(b),K=function(t){function e(e){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"users")||this}u(e,t);var r=e.prototype;return r.get=function(){try{return Promise.resolve(this.request.getList(this.getPath()))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".get()")},e}(b),V=function(t){function e(e,r){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"users",r)||this}u(e,t);var r=e.prototype;return r.delete=function(){try{return Promise.resolve(this.request.delete(this.getPath()))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".delete()")},e}(b),H=function(t){function e(e){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"qrcodes")||this}u(e,t);var r=e.prototype;return r.create=function(t){try{return t.locatorKeyType||(t.locatorKeyType=m.SHORT_URL),Promise.resolve(this.request.post(this.getPath(),{},t))}catch(t){return Promise.reject(t)}},r.get=function(t){try{return Promise.resolve(this.request.get(this.getPath(),t))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".create()")},e}(b),J=function(t){function e(e,r,n,s){return t.call(this,e,r,n,"projects",s)||this}u(e,t);var r=e.prototype;return r.get=function(){try{return Promise.resolve(this.request.get(this.getPath()))}catch(t){return Promise.reject(t)}},r.update=function(t){try{return Promise.resolve(this.request.patch(this.getPath(),{},t))}catch(t){return Promise.reject(t)}},r.delete=function(){try{return Promise.resolve(this.request.delete(this.getPath()))}catch(t){return Promise.reject(t)}},r.assets=function(){return new z(this)},r.assetsBatch=function(){return new M(this)},r.contacts=function(){return new x(this)},r.contactsBatch=function(){return new F(this)},r.users=function(){return new K(this)},r.user=function(t){return new V(this,t)},r.qrCodes=function(){return new H(this)},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".get()"),t.push(this.getSdkPath()+".update(properties: IProject)"),t.push(this.getSdkPath()+".delete()"),this.assets().describeSdkEndpoints(t),this.assetsBatch().describeSdkEndpoints(t),this.contacts().describeSdkEndpoints(t),this.contactsBatch().describeSdkEndpoints(t),this.users().describeSdkEndpoints(t),this.user("{userId}").describeSdkEndpoints(t),this.qrCodes().describeSdkEndpoints(t)},e}(b),Y=function(t){function e(e,r){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"contacts",r)||this}u(e,t);var r=e.prototype;return r.update=function(t){try{return Promise.resolve(this.request.patch(this.getPath(),{},t))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".update(contact: IContact)")},e}(b),Q=function(t){function e(e){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"contacts")||this}u(e,t);var r=e.prototype;return r.create=function(t){try{return Promise.resolve(this.request.post(this.getPath(),{},t))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".create(contact: IContact)")},e}(b),W=function(t){function e(e){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"sms")||this}u(e,t);var r=e.prototype;return r.create=function(t){try{return Promise.resolve(this.request.post(this.getPath(),{},t))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".create()")},e}(b),X=function(t){function e(e,r,n,s){return t.call(this,e,r,n,"scans",s)||this}u(e,t);var r=e.prototype;return r.get=function(){try{return Promise.resolve(this.request.get(this.getPath()))}catch(t){return Promise.reject(t)}},r.contacts=function(){return new Q(this)},r.contact=function(t){return new Y(this,t)},r.smss=function(){return new W(this)},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".get()"),this.contacts().describeSdkEndpoints(t),this.contact("{contactId}").describeSdkEndpoints(t),this.smss().describeSdkEndpoints(t)},e}(b),$=function(t){function e(e,r,n,s){return t.call(this,e,r,n,"qrcodes",s)||this}u(e,t);var r=e.prototype;return r.get=function(t){try{return Promise.resolve(this.request.get(this.getPath(),t))}catch(t){return Promise.reject(t)}},r.update=function(t){try{return Promise.resolve(this.request.patch(this.getPath(),{},t))}catch(t){return Promise.reject(t)}},r.delete=function(){try{return Promise.resolve(this.request.delete(this.getPath()))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".get()"),t.push(this.getSdkPath()+".update(properties: IQrCode)"),t.push(this.getSdkPath()+".delete()")},e}(b),Z=function(t){function e(e){return t.call(this,e.getSession(),e.getPath(),e.getSdkPath(),"accounts")||this}u(e,t);var r=e.prototype;return r.create=function(t){try{return Promise.resolve(this.request.post(this.getPath(),{},t))}catch(t){return Promise.reject(t)}},r.get=function(){try{return Promise.resolve(this.request.getList(this.getPath()))}catch(t){return Promise.reject(t)}},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".create(properties: IAccount)"),t.push(this.getSdkPath()+".get()")},e}(b),tt=function(t){function e(e,r,n,s){return t.call(this,e,r,n,"users",s)||this}u(e,t);var r=e.prototype;return r.get=function(){try{return Promise.resolve(this.request.get(this.getPath()))}catch(t){return Promise.reject(t)}},r.update=function(t){try{return Promise.resolve(this.request.patch(this.getPath(),{},t))}catch(t){return Promise.reject(t)}},r.delete=function(){try{return Promise.resolve(this.request.delete(this.getPath()))}catch(t){return Promise.reject(t)}},r.accounts=function(){return new Z(this)},r.describeSdkEndpoints=function(t){t.push(this.getSdkPath()+".get()"),t.push(this.getSdkPath()+".update(properties: IUser)"),t.push(this.getSdkPath()+".delete()"),this.accounts().describeSdkEndpoints(t)},e}(b),et=function(){function r(){this._config=void 0,this.cloudConfigName=void 0,this.cloudConfig=void 0,this.userPool=void 0,this.userId=void 0,this.isAdministrator=void 0,this.activeUser=void 0,this.requestFactory={}}var n,s=r.prototype;return s.getRequest=function(t){return this.requestFactory[t]()},s.config=function(t){var e=this;if(this._config)throw Error("Openscreen client is already configured");if(!t.key)throw Error("Openscreen invalid config, API key is missing");if(!t.secret)throw Error("Openscreen invalid config, secret is missing");return"string"==typeof t.environment?this.cloudConfigName=t.environment:"object"==typeof t.environment?this.cloudConfig=Promise.resolve(t.environment):this.cloudConfigName="api-production",this._config=t,this.requestFactory.accounts=function(){return new I(e)},this.requestFactory.apikeys=function(){return new I(e)},this.requestFactory.assets=function(){return new I(e)},this.requestFactory.assetsBatch=function(){return new I(e)},this.requestFactory.contacts=function(){return new I(e)},this.requestFactory.contactsBatch=function(){return new I(e)},this.requestFactory.invitations=function(){return new I(e)},this.requestFactory.projects=function(){return new I(e)},this.requestFactory.qrcodes=function(){return new I(e)},this.requestFactory.scans=function(){return new I(e)},this.requestFactory.sms=function(){return new I(e)},this.requestFactory.users=function(){return new I(e)},this},s.getConfig=function(){if(!this._config)throw Error("Openscreen client must be configured before accessing resources");return this._config},s.authorize=function(){try{var t=this,r=t.getConfig();return Promise.resolve(t.getCloudConfig()).then(function(n){function s(){return delete r.key,delete r.secret,Promise.resolve(i.getSession()).then(function(r){var n=r.getIdToken(),s=n.payload;t.userId=s.sub;var o=s["cognito:groups"];return t.isAdministrator=o&&o.includes("appadmin"),s.email?process.env.OS_DEBUG&&console.info("Openscreen authorized as '"+s.email+"' (userId: "+s.sub+"), session expires "+e(1e3*n.getExpiration()).fromNow()+", authorized "+e(1e3*n.getIssuedAt()).fromNow()):process.env.OS_DEBUG&&console.info("Openscreen authorized as userId: "+s.sub+", session expires "+e(1e3*n.getExpiration()).fromNow()+", authorized "+e(1e3*n.getIssuedAt()).fromNow()),i})}t.userPool=new E(n.poolId,n.clientId,r.storage);var i=t.userPool.getUser(r.key),o=function(){if(!i)return Promise.resolve(t.userPool.authenticate(r.key,r.secret)).then(function(t){i=t});process.env.OS_DEBUG&&console.info("Openscreen authorized user retrieved from cache")}();return o&&o.then?o.then(s):s()})}catch(t){return Promise.reject(t)}},s.getCloudConfig=function(){try{var t=this;if(!t.cloudConfig){if(!t.cloudConfigName)throw Error("Openscreen environment config missing");t.cloudConfig=function(t){try{var e=o.create({baseURL:"https://config.openscreen.com",timeout:1e4,responseType:"json",maxContentLength:5e4,maxBodyLength:5e4,maxRedirects:1,decompress:!0});return Promise.resolve(e.get(t+".json").then(function(t){return t.data}).catch(function(e){throw new Error("Unable to load configuration '"+t+"': "+e.message)}))}catch(t){return Promise.reject(t)}}(t.cloudConfigName)}return Promise.resolve(t.cloudConfig)}catch(t){return Promise.reject(t)}},s.getActiveUser=function(){try{var t=this;return t.activeUser||(t.activeUser=t.authorize()),Promise.resolve(t.activeUser)}catch(t){return Promise.reject(t)}},s.authorizedUserId=function(){try{var t=this;return Promise.resolve(t.getActiveUser()).then(function(){return t.userId||""})}catch(t){return Promise.reject(t)}},s.amIAdministrator=function(){try{var t=this;return Promise.resolve(t.getActiveUser()).then(function(){return!0===t.isAdministrator})}catch(t){return Promise.reject(t)}},s.account=function(t){return new U(this,"","os",t)},s.apiKey=function(t){return new O(this,"","os",t)},s.asset=function(t){return new L(this,"","os",t)},s.contact=function(t){return new B(this,"","os",t)},s.invitation=function(t){return new G(this,"","os",t)},s.project=function(t){return new J(this,"","os",t)},s.scan=function(t){return new X(this,"","os",t)},s.qrCode=function(t){return new $(this,"","os",t)},s.user=function(t){return new tt(this,"","os",t)},s.describeSdkEndpoints=function(){var t=[];return this.account("{accountId}").describeSdkEndpoints(t),this.apiKey("{apiKeyId}").describeSdkEndpoints(t),this.asset("{assetId}").describeSdkEndpoints(t),this.contact("{contactid}").describeSdkEndpoints(t),this.invitation("{invitationId}").describeSdkEndpoints(t),this.project("{projectId}").describeSdkEndpoints(t),this.scan("{scanId}").describeSdkEndpoints(t),this.qrCode("{qrCodeId}").describeSdkEndpoints(t),this.user("{userId}").describeSdkEndpoints(t),t.sort()},s.saveQrImageDataToFile=function(e,r){try{var n,s,i,o;if(null==(n=e.image)||!n.data)throw new Error("No image data present for QR code, qrCodeId='"+(e.qrCodeId||"")+"'");return o=null!=(s=e.image)&&null!=(i=s.options)&&i.dataUrl?Buffer.from(e.image.data.replace(/^data:image\/\w+;base64,/,""),"base64").toString("binary"):Buffer.from(e.image.data,"base64").toString("binary"),Promise.resolve(t.writeFile(r,o,"binary")).then(function(){})}catch(t){return Promise.reject(t)}},(n=[{key:"client",get:function(){return r.commonClient||(r.commonClient=new r),r.commonClient}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(r,n),r}();et.commonClient=void 0;export{a as AccountStatus,et as Openscreen,g as ProjectInvitationStatus,P as ProjectStatus,f as QrCodeErrorCorrectionLevel,l as QrCodeIntentType,m as QrCodeLocatorKeyType,v as QrCodeStatus,S as QrCodeType};
//# sourceMappingURL=index.modern.js.map
